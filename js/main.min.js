/*! ========================================================================
 * Maricopa Association of Governments
 * JavaScript files for MAG Wickenburg Zoning Map Viewer
 * @main.min.js | version | 3.7.8
 * Production | 02/14/2017
 * http://geo.azmag.gov/maps/wickenburg/
 * MAG Wickenburg Zoning Map Viewer
 * ==========================================================================
 * Copyright 2016 MAG
 * Licensed under MIT
 * ========================================================================== */

function toggleContent(){$("#legend").is(":hidden")?($("#legend").fadeIn(),$("#legend").draggable({containment:"#mapDiv"}),$("#contentsOpen")):($("#legend").fadeOut(),$("#contentsOpen"))}function toggleMTool(){$("#mTool").is(":hidden")?($("#mTool").fadeIn(),$("#mTool").draggable({containment:"#mapDiv"}),$("#measureOpen")):($("#mTool").fadeOut(),$("#measureOpen"))}function togglePrint(){$("#printTool").is(":hidden")?($("#printTool").fadeIn(),$("#printTool").draggable({containment:"#mapDiv"}),$("#printOpen")):($("#printTool").fadeOut(),$("#printOpen"))}function toggleReportWindow(){$("#reportTool").is(":hidden")?($("#reportTool").fadeIn(),$("#reportTool").draggable({containment:"#mapDiv"})):($("#reportTool").fadeOut(),$("#reportOpen"))}function toggleMarkupTools(){$("#markupTool").is(":hidden")?($("#markupTool").fadeIn(),$("#markupTool").draggable({containment:"#mapDiv"})):$("#markupTool").fadeOut(),$("#textSettings").hide()}function toggleSelectedButton(a){$(".btn-primary").removeClass("btn-primary"),$("#"+a).addClass("btn-primary")}var map,toolbar,graphicsCollection=[],fillColorSelection={r:0,g:0,b:255},outlineColorSelection={r:0,g:0,b:0};require(["dojo/dom-construct","dojo/dom","dojo/dom-style","esri/toolbars/draw","esri/toolbars/edit","dojo/on","dojo/parser","dojo/_base/connect","dojo/query","dojo/keys","esri/sniff","esri/map","esri/dijit/Measurement","esri/dijit/Scalebar","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/graphic","esri/geometry/Extent","esri/geometry/Multipoint","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/TextSymbol","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","esri/dijit/Popup","dojo/_base/array","dojo/_base/Color","dojo/_base/event","esri/layers/LayerDrawingOptions","esri/renderers/SimpleRenderer","esri/layers/ImageParameters","esri/dijit/Search","esri/tasks/locator","esri/dijit/Legend","dijit/form/CheckBox","dijit/form/HorizontalSlider","dijit/form/HorizontalRule","dijit/form/HorizontalRuleLabels","esri/dijit/BasemapToggle","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/dijit/PopupTemplate","esri/InfoTemplate","esri/symbols/SimpleMarkerSymbol","esri/dijit/Print","esri/tasks/PrintTemplate","esri/request","esri/config","js/vendor/bootstrapmap.min.js","dojo/domReady!"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y){function Z(a){var c,d,e;return c=A.filter(a.parameters,function(a,b){return"Layout_Template"===a.name}),0===c.length?void console.log('print service parameters name for templates must be "Layout_Template"'):(d=c[0].choiceList,mapOnlyRemove=A.indexOf(d,"MAP_ONLY"),mapOnlyRemove>-1&&d.splice(mapOnlyRemove,mapOnlyRemove),e=A.map(d,function(a){var b=new V;return b.layout=b.label=a,b.format="PDF",b.layoutOptions={titleText:"Wickenburg Zoning"},b}),printer=new U({map:map,templates:e,url:appConfig.printUrl},b.byId("printButton")),void printer.startup())}function _(a){console.log("Something broke: ",a)}function aa(a){if($("#multiple").is(":checked")){if(ja(),"tParcels"===a.target.features[0]._layer.id){var b=new q(a.target._highlighted.geometry,a.target._highlighted.symbol);map.graphics.add(b)}}else for(var c=0;c<graphicsCollection.length;c++)map.graphics.add(graphicsCollection[c])}function ba(a){var b=map.getLayer("tParcels"),c=new v(v.STYLE_SOLID,new B([255,170,0]),1);c.setWidth(a);var d=new E(c);b.setRenderer(d),b.refresh()}function ca(a){1===a?$("#ThicknessSlider").fadeIn():$("#ThicknessSlider").fadeOut()}function da(){$(".esriSimpleSliderDecrementButton").addClass("esriSimpleSliderDisabledButton"),ea(),ga(),$("#btnUndo").click(ia),$("#btnAdd").click(la),$("#markupDropdown").change(ma),$(".color").colorPicker({renderCallback:function(a,b){b===!1&&editToolbar._graphic&&("picker1"===a[0].id?oa(a[0].value):"picker2"===a[0].id&&pa(a[0].value))}}),$("body").on("mousemove",function(a){$("#tail").css({left:a.pageX+20,top:a.pageY})}),$("#tail").hide(),$("#fillTransparencySlider").slider({min:0,max:1,step:.1,value:appConfig.fillColorOpacity})}function ea(a){toolbar=new d(map),toolbar.on("draw-end",ka)}function fa(){var a=$("#markupDropdown").val();toolbar.activate(d[a]),map.setInfoWindowOnClick(!1),$("#tail").show(),ja(),map.hideZoomSlider()}function ga(){editToolbar=new e(map),map.graphics.on("click",function(a){$("#btnEdit").hasClass("btn-primary")?(C.stop(a),ha(a.graphic),$(".editMarkupBtns button").removeClass("btn-primary")):$("#btnErase").hasClass("btn-primary")&&(map.graphics.remove(a.graphic),$(".editMarkupBtns button").removeClass("btn-primary"))}),map.on("click",function(a){editToolbar.deactivate()})}function ha(a){var b=0;b|=e.MOVE,b|=e.EDIT_VERTICES,b|=e.SCALE,b|=e.ROTATE,"esri.symbol.TextSymbol"===a.symbol.declaredClass&&(b|=e.EDIT_TEXT);var c={allowAddVertices:!0,allowDeleteVertices:!0,uniformScaling:!0};editToolbar.activate(b,a,c)}function ia(){var a=graphicsCollection.pop();map.graphics.remove(a),$(".editMarkupBtns button").removeClass("btn-primary")}function ja(){map.infoWindow.hide()}function ka(a){map.setInfoWindowOnClick(!0);var b;$("#tail").hide(),toolbar.deactivate(),map.showZoomSlider();var c=$("#outlineColor :first-child").css("background-color"),d=$("#fillTransparencySlider").slider("option","value"),e=$("#fillColor :first-child").css("background-color");e=e.slice(0,-1)+", "+d+")";var f=$("#textDropdown").val(),g=$("#inputText").val();switch(a.geometry.type){case"point":b=new w,b.setText(g);var h=new esri.symbol.Font;h.setSize(f);var i=new B;i.setColor(e),b.setFont(h),b.setColor(i);break;case"multipoint":b=new T;break;case"polyline":b=new v;break;default:b=new u(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,c,3),e)}var j=new q(a.geometry,b);graphicsCollection.push(j),map.graphics.add(j),$("#btnAdd").removeClass("btn-primary"),$("*").css("cursor","default")}function la(){var a=$("#markupDropdown").val(),b=($("#textSettings"),$("#outlineColor"),$("#inputText"));switch($(".editMarkupBtns button").removeClass("btn-primary"),fa(),$("#btnAdd").addClass("btn-primary"),$("*").css("cursor","crosshair"),a){case"POINT":var c=$(b).val();""===c&&($(b).css("border","2px solid red"),$("*").css("cursor","default"),$(".editMarkupBtns button").removeClass("btn-primary"),alert("Please enter a text value before trying to add a label."));break;case"POLYGON":break;case"CIRCLE":break;case"ARROW":break;case"FREEHAND_POLYGON":}}function ma(a){"POINT"===a.target.value?($("#textSettings").show(),$("#outlineColor").hide()):($("#textSettings").hide(),$("#outlineColor").show())}function na(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null}function oa(a){var b=na(a);fillColorSelection=b,null!==editToolbar._vertexEditor&&null!==editToolbar._graphic?qa():ra()}function pa(a){var b=a;outlineColorSelection=b,null!==editToolbar._graphic&&qa()}function qa(){var a=fillColorSelection,b=outlineColorSelection,c=$("#fillTransparencySlider").slider("option","value"),d=new u(u.STYLE_SOLID,new v(v.STYLE_SOLID,new B(b),3),new B([a.r,a.g,a.b,c]));editToolbar._graphic.setSymbol(d)}function ra(){var a=fillColorSelection,b=new w(self.textInput()).setColor(new B([a.r,a.g,a.b,1])),c=new Font;c.setSize(self.fontSize.toString()+"pt"),b.setFont(c),editToolbar._graphic.setSymbol(b)}function sa(a){var b=1;return"-"===a[0]&&(b=-1,a=a.substr(1)),function(c,d){var e=c[a]<d[a]?-1:c[a]>d[a]?1:0;return e*b}}g.parse(),esri.config.defaults.io.proxyUrl="proxy/proxy.ashx",esri.config.defaults.io.alwaysUseProxy=!1,b.byId("version").innerHTML=appConfig.Version,b.byId("demLink").setAttribute("href",appConfig.demService),b.byId("empLink").setAttribute("href",appConfig.empService);var ta=!1,ua=[],va=[],wa=1,xa=new u(u.STYLE_SOLID,new v(v.STYLE_SOLID,new B([0,128,255]),3),null),ya=new u(u.STYLE_BACKWARD_DIAGONAL,new v(v.STYLE_SOLID,new B([0,255,255]),2),new B([0,255,255,.25])),za=new T("circle",26,null,new B([0,0,0,.25])),Aa=new z({fillSymbol:ya,markerSymbol:za,visibleWhenEmpty:!1,keepHighlightOnHide:!1,hideDelay:-1},a.create("div"));Aa.on("show",aa),Aa.on("hide",aa),map=Y.create("mapDiv",{extent:new r(appConfig.initExtent),basemap:"streets",minZoom:11,maxZoom:19,showAttribution:!1,logo:!1,infoWindow:Aa,sliderPosition:"top-right",scrollWheelZoom:!0});var Ba=new G({map:map,sources:[{locator:new H(appConfig.LocatorService),singleLineFieldName:"SingleLine",autoNavigate:!0,enableInfoWindow:!0,enableHighlight:!1,autoSelect:!1,showInfoWindowOnSelect:!0,name:"Address",searchExtent:new r(appConfig.initExtent),placeholder:"21 North Frontier Street"}]},"search");Ba.startup();var Ca;h.connect(Aa,"onClearFeatures",function(){Ca=Aa}),map.on("load",da),$("#highlight").hide(),$("#multiple").click(function(){$(this).data("clicked",!0),ta=!0});var Da=$("#single");Da.click(function(){ta=!1}),$("#clearHighlights").click(function(){ta=!1,map.graphics.clear();for(var a=0;a<graphicsCollection.length;a++)map.graphics.add(graphicsCollection[a]);$(Da).prop("checked",!0)});var Ea=(new n({map:map,scalebarUnit:"english"}),new o({map:map,visible:!0},a.create("div",{id:"HomeButton"},"mapDiv","last")));Ea._homeNode.title="Original Extent",Ea.startup();var Fa=new p({map:map,visible:!0},a.create("div",{id:"LocateButton"},"mapDiv","last"));Fa.on("locate",function(a){ja()}),Fa.startup();var Ga=W({url:appConfig.printUrl,content:{f:"json"}});Ga.then(Z,_),appConfig.layerInfo.sort(sa("-mapOrder"));for(var Ha=0;Ha<appConfig.layerInfo.length;Ha++){var Ia=appConfig.layerInfo[Ha],Ja="";""!==Ia.popupHeader&&""!==Ia.popupBody&&(Ja=new S(Ia.popupHeader,Ia.popupBody));var Ka=new O(Ia.url,{id:Ia.id,mode:O.MODE_ONDEMAND,visible:Ia.visible,infoTemplate:Ja,opacity:Ia.opacity,outFields:["*"]});map.addLayer(Ka),Ia.showLegend===!0&&va.push({layer:map.getLayer(Ia.id),id:Ia.id,title:Ia.title,legendOrder:Ia.legendOrder}),Ia.showCheckBox===!0&&ua.push({layer:map.getLayer(Ia.id),id:Ia.id,title:Ia.title,tocOrder:Ia.tocOrder})}ua.sort(sa("-tocOrder")),va.sort(sa("-legendOrder"));var La=new Q(appConfig.imageryLayer,{visible:!1});map.addLayer(La);var Ma=new m({map:map,lineSymbol:xa},b.byId("measurementDiv"));Ma.on("measure-start",function(a){map.setInfoWindowOnClick(!1)}),Ma.on("measure-end",function(a){map.setInfoWindowOnClick(!0)}),Ma.startup();var Na=new I({map:map,layerInfos:va},"legendDiv");Na.startup(),A.forEach(ua,function(c){var d=c.title,e=new J({name:"checkBox"+c.layer.id,value:c.layer.id,checked:c.layer.visible,onChange:function(){var a=map.getLayer(this.value);a.setVisibility(!a.visible),"tParcels"===this.value&&(this.checked?(a.visible,ca(1),$("#highlight").fadeIn()):($("#highlight").fadeOut(),ca(0))),"wiZoning"===this.value&&(this.checked?$("#zoneDefinitionsLink").show():$("#zoneDefinitionsLink").hide()),("wiFlood"===this.value||"wiPendFlood"===this.value)&&(map.getLayer("wiFlood").visible||map.getLayer("wiPendFlood").visible?$("#floodZoneDefinitionsLink").show():$("#floodZoneDefinitionsLink").hide())}});a.place(e.domNode,b.byId("toggleDiv"));var f=a.create("label",{"for":e.name,innerHTML:"&nbsp;&nbsp;"+d},e.domNode,"after");a.place("<br>",f,"after")});var Oa=(new K({name:"slider1",value:map.getLayer("wiFlood").opacity,minimum:0,maximum:1,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){map.getLayer("wiFlood").setOpacity(a)}},"slider1"),new K({name:"slider2",value:map.getLayer("wiZoning").opacity,minimum:0,maximum:1,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){map.getLayer("wiZoning").setOpacity(a)}},"slider2"),new K({name:"slider4",value:map.getLayer(map.basemapLayerIds).opacity,minimum:0,maximum:1,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){map.getLayer(map.basemapLayerIds).layerInfos[0].name;wa=1-a,La.show(),map.getLayer(map.basemapLayerIds).setOpacity(a),La.setOpacity(wa),0===wa&&La.hide()}},"slider4"),new K({name:"slider3",value:.5,minimum:1,maximum:5,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){ba(a)}},"slider3"),a.create("a",{"class":"action",id:"aInfoLink",innerHTML:"Assessor Info",href:"javascript: void(0);"},i(".actionList",map.infoWindow.domNode)[0]));f(Oa,"click",function(){var a=map.infoWindow.getSelectedFeature();console.log(a);var b=(window.location,"");"013"===a.attributes.COUNTYFP10?(b=appConfig.MaricopaAssessor+a.attributes.PARCEL_APN,window.open(b)):"025"===a.attributes.COUNTYFP10&&(b=appConfig.YavapaiAssessor+a.attributes.PARCEL_APN,window.open(b))});var Pa=a.create("a",{"class":"action",id:"rInfoLink",innerHTML:"Recorder Info",href:"javascript: void(0);"},i(".actionList",map.infoWindow.domNode)[0]);f(Pa,"click",function(){var a=map.infoWindow.getSelectedFeature();console.log(a);var b=(window.location,appConfig.MaricopaRecorder+a.attributes.MCR_BOOK+"&page="+a.attributes.MCR_PAGE);window.open(b)}),h.connect(Aa,"onSelectionChange",function(){var a=Aa.getSelectedFeature();a&&(a.attributes.PARCEL_APN?($("#aInfoLink").show(),$("#rInfoLink").hide()):a.attributes.MCR?($("#rInfoLink").show(),$("#aInfoLink").hide()):($("#aInfoLink").hide(),$("#rInfoLink").hide()))})}),$(document).ready(function(){$("#contentsOpen").fadeTo("slow"),$("#legend").fadeTo("slow"),$("#legend").draggable({containment:"#mapDiv"}),contentsOpen=$("#contentsOpen").height(),$("#legend").css("top","55px"),$("#contentsOpen").click(function(){toggleContent()})}),$(document).ready(function(){$("#measureOpen").fadeTo("slow"),$("#mTool").fadeTo("slow"),measureOpen=$("#measureOpen").height(),$("#mTool").css("top","55px"),$("#measureOpen").click(function(){toggleMTool()})}),$(document).ready(function(){$("#mTool").hide()}),$(document).ready(function(){$("#printOpen").fadeTo("slow"),$("#printTool").fadeTo("slow"),printOpen=$("#printOpen").height(),$("#printTool").css("top","55px"),$("#printOpen").click(function(){togglePrint()}),$("#reportOpen").fadeTo("slow"),$("#reportTool").fadeTo("slow"),reportOpen=$("#reportOpen").height(),$("#reportOpen").click(function(){toggleReportWindow()})}),$(document).ready(function(){$("#markupOpen").fadeTo("slow"),$("#markupTool").fadeTo("slow"),$("#markupTool").css("top","55px"),$("#markupOpen").click(function(){toggleMarkupTools(),$("#picker1").css("background-color",appConfig.defaultFillColor),$("#picker2").css("background-color",appConfig.defaultOutlineColor)})}),$(document).ready(function(){$("#printTool").hide(),$("#reportTool").hide(),$("#markupTool").hide()}),$(document).ready(function(){$("#legend").load("views/contents.html"),$("#helpContent").load("views/helpContent.html"),$("#aboutInfo").load("views/about.html"),$("#legalDisclaimer").load("views/legalDisclaimer.html"),$("#definitions").load("views/definitions.html"),$("#floodDefinitions").load("views/floodDefinitions.html"),$("#mTool").load("views/measureTool.html"),$("#helpTool").load("views/helpTool.html"),$("#printTool").load("views/printTool.html"),$("#helpPrint").load("views/helpPrint.html"),$("#reportTool").load("views/reportWindow.html"),$("#markupTool").load("views/markupTool.html"),$("#helpMarkup").load("views/helpMarkup.html")});