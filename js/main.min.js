/*!
 * @main.min.js
 * @JavaScript document for Wickenburg Zoning Map Viewer @ MAG
 * @For Production
 * @Wickenburg-Project - v3.7.4 | 02-08-2016
 * @author Vern Wolfley & Jack Fairfield
*/

function toggleContent(){$("#legend").is(":hidden")?($("#legend").fadeIn(),$("#legend").draggable({containment:"#mapDiv"}),$("#contentsOpen")):($("#legend").fadeOut(),$("#contentsOpen"))}function toggleMTool(){$("#mTool").is(":hidden")?($("#mTool").fadeIn(),$("#mTool").draggable({containment:"#mapDiv"}),$("#measureOpen")):($("#mTool").fadeOut(),$("#measureOpen"))}function togglePrint(){$("#printTool").is(":hidden")?($("#printTool").fadeIn(),$("#printTool").draggable({containment:"#mapDiv"}),$("#printOpen")):($("#printTool").fadeOut(),$("#printOpen"))}function toggleReportWindow(){$("#reportTool").is(":hidden")?($("#reportTool").fadeIn(),$("#reportTool").draggable({containment:"#mapDiv"})):($("#reportTool").fadeOut(),$("#reportOpen"))}require(["dojo/dom-construct","dojo/dom","dojo/on","dojo/parser","dojo/_base/connect","dojo/query","dojo/keys","esri/sniff","esri/map","esri/SnappingManager","esri/dijit/Measurement","esri/dijit/Scalebar","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/dijit/Geocoder","esri/graphic","esri/geometry/Extent","esri/geometry/Multipoint","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","esri/dijit/Popup","dojo/_base/array","dojo/_base/Color","esri/layers/LayerDrawingOptions","esri/renderers/SimpleRenderer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ImageParameters","esri/dijit/Legend","dijit/form/CheckBox","dijit/form/HorizontalSlider","dijit/form/HorizontalRule","dijit/form/HorizontalRuleLabels","esri/dijit/BasemapToggle","esri/layers/FeatureLayer","esri/dijit/PopupTemplate","esri/InfoTemplate","esri/symbols/SimpleMarkerSymbol","esri/dijit/Print","esri/tasks/PrintTemplate","esri/request","esri/config","js/vendor/bootstrapmap.min.js","dojo/domReady!"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S){function T(a){var c,d,e;return c=y.filter(a.parameters,function(a,b){return"Layout_Template"===a.name}),0===c.length?void console.log('print service parameters name for templates must be "Layout_Template"'):(d=c[0].choiceList,mapOnlyRemove=y.indexOf(d,"MAP_ONLY"),mapOnlyRemove>-1&&d.splice(mapOnlyRemove,mapOnlyRemove),e=y.map(d,function(a){var b=new P;return b.layout=b.label=a,b.format="PDF",b.layoutOptions={titleText:"Wickenburg Zoning"},b}),printer=new O({map:oa,templates:e,url:appConfig.printUrl},b.byId("printButton")),void printer.startup())}function U(a){console.log("Something broke: ",a)}function V(){var a=this.dojoAttachPoint,b=Pa[a].checked;b===!0&&qa.remove(),b!==!0&&(qa=oa.on("click",fa))}function W(){$("#multiple").data("clicked")&&qa.remove()}function X(a){var b=oa.getLayer("tParcels"),c=[],d=new A,e=new u(u.STYLE_SOLID,new z([255,170,0]),1);e.setWidth(a);var f=new t(t.STYLE_SOLID,e,new z([255,255,0,0]));d.renderer=new B(f),c[1]=d,b.setLayerDrawingOptions(c)}function Y(a){1===a?$("#ThicknessSlider").fadeIn():$("#ThicknessSlider").fadeOut()}function Z(a){var b=a.graphic?a.graphic:a.result.feature;b.setSymbol(Ra),aa(a.result,b.symbol)}function _(a){if(a=a.results,a.length>0){ca();for(var b=Ra,c=0;c<a.length;c++)aa(a[c],b);ba(a)}else alert("Sorry, address or place not found.")}function aa(a,b){var c,d,e,f,g={};e=a.feature.geometry,g.address=a.name,g.score=a.feature.attributes.Score,c={address:g.address,score:g.score,lat:e.getLatitude().toFixed(2),lon:e.getLongitude().toFixed(2)},d=new M("${address}","Latitude: ${lat}<br/>Longitude: ${lon}<br/>Score: ${score}"),f=new p(e,b,c,d),oa.graphics.add(f)}function ba(a){for(var b=new r(oa.spatialReference),c=0;c<a.length;c++)b.addPoint(a[c].feature.geometry);oa.setExtent(b.getExtent().expand(2))}function ca(){oa.infoWindow.hide(),oa.graphics.clear()}function da(a,b,c){return new s({angle:0,xoffset:b,yoffset:c,type:"esriPMS",url:a,contentType:"image/png",width:12,height:24})}function ea(){$(".esriSimpleSliderDecrementButton").addClass("esriSimpleSliderDisabledButton"),identifyTask1=new v(appConfig.mainURL),identifyParamsTask1=new w,identifyParamsTask1.layerIds=[6],identifyParamsTask1.tolerance=3,identifyParamsTask1.returnGeometry=!0,identifyParamsTask1.layerOption=w.LAYER_OPTION_VISIBLE,identifyParamsTask1.width=oa.width,identifyParamsTask1.height=oa.height,identifyTask2=new v(appConfig.mainURL),identifyParamsTask2=new w,identifyParamsTask2.layerIds=[1],identifyParamsTask2.tolerance=3,identifyParamsTask2.returnGeometry=!0,identifyParamsTask2.layerOption=w.LAYER_OPTION_VISIBLE,identifyParamsTask2.width=oa.width,identifyParamsTask2.height=oa.height,identifyTask3=new v(appConfig.mainURL),identifyParamsTask3=new w,identifyParamsTask3.layerIds=[4],identifyParamsTask3.tolerance=3,identifyParamsTask3.returnGeometry=!0,identifyParamsTask3.layerOption=w.LAYER_OPTION_VISIBLE,identifyParamsTask3.width=oa.width,identifyParamsTask3.height=oa.height,identifyTask4=new v(appConfig.mainURL),identifyParamsTask4=new w,identifyParamsTask4.layerIds=[5],identifyParamsTask4.tolerance=3,identifyParamsTask4.returnGeometry=!0,identifyParamsTask4.layerOption=w.LAYER_OPTION_VISIBLE,identifyParamsTask4.width=oa.width,identifyParamsTask4.height=oa.height}function fa(a){ha&&ga&&(oa.graphics.add(new p(ga.features[0].geometry,la)),ga=""),ha||oa.graphics.clear();for(var b=(oa.layerIds,ia),c=0;c<b.length;c++){var d=b[c].layer.visible,e=b[c].id;"wiZoning"===e&&d===!0&&(identifyParamsTask1.layerIds=[6]),"wiZoning"===e&&d===!1&&(identifyParamsTask1.layerIds=[-1]),"tParcels"===e&&d===!0&&(identifyParamsTask2.layerIds=[1]),"tParcels"===e&&d===!1&&(identifyParamsTask2.layerIds=[-1]),"wiFlood"===e&&d===!0&&(identifyParamsTask3.layerIds=[4]),"wiFlood"===e&&d===!1&&(identifyParamsTask3.layerIds=[-1]),"wiPendFlood"===e&&d===!0&&(identifyParamsTask4.layerIds=[5]),"wiPendFlood"===e&&d===!1&&(identifyParamsTask4.layerIds=[-1])}identifyParamsTask1.geometry=a.mapPoint,identifyParamsTask1.mapExtent=oa.extent,identifyParamsTask2.geometry=a.mapPoint,identifyParamsTask2.mapExtent=oa.extent,identifyParamsTask3.geometry=a.mapPoint,identifyParamsTask3.mapExtent=oa.extent,identifyParamsTask4.geometry=a.mapPoint,identifyParamsTask4.mapExtent=oa.extent;var f=identifyTask1.execute(identifyParamsTask1).addCallback(function(a){return y.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new M;c.setTitle("Wickenburg Zoning"),c.setContent("Zoning Code: ${CODE}<br>Zoning Description: ${Description}"),b.setInfoTemplate(c)}return b})}),g=identifyTask2.execute(identifyParamsTask2).addCallback(function(a){return y.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new M;c.setTitle("County Parcels"),c.setContent("County: ${COUNTY}<br>Parcel: ${PARCEL_LABEL}<br>Address: ${PHYSICAL_ADDRESS}"),b.setInfoTemplate(c)}return b})}),h=identifyTask3.execute(identifyParamsTask3).addCallback(function(a){return y.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new M;c.setTitle("Flood Zone"),c.setContent("Flood Zone: ${ZONE}"),b.setInfoTemplate(c)}return b})}),i=identifyTask4.execute(identifyParamsTask4).addCallback(function(a){return y.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new M;c.setTitle("Pending Flood Zone"),c.setContent("Pending Flood Zone: ${FloodZone}"),b.setInfoTemplate(c)}return b})});oa.infoWindow.setFeatures([f,g,h,i]),oa.infoWindow.show(a.mapPoint)}d.parse(),esri.config.defaults.io.proxyUrl="proxy/proxy.ashx",esri.config.defaults.io.alwaysUseProxy=!1,b.byId("version").innerHTML=appConfig.Version,b.byId("demLink").setAttribute("href",appConfig.demService),b.byId("empLink").setAttribute("href",appConfig.empService);var ga,ha=!1,ia=[],ja=[],ka=new t(t.STYLE_SOLID,new u(u.STYLE_SOLID,new z([0,128,255]),3),null),la=new t(t.STYLE_BACKWARD_DIAGONAL,new u(u.STYLE_SOLID,new z([0,255,255]),2),new z([0,255,255,.25])),ma=new N("circle",26,null,new z([0,0,0,.25])),na=new x({fillSymbol:la,markerSymbol:ma,visibleWhenEmpty:!1,keepHighlightOnHide:!0,hideDelay:-1},a.create("div")),oa=S.create("mapDiv",{extent:new q(appConfig.initExtent),basemap:"streets",minZoom:11,maxZoom:19,showAttribution:!1,logo:!1,infoWindow:na,sliderPosition:"top-right",scrollWheelZoom:!0});e.connect(na,"onClearFeatures",function(){ga=na}),e.connect(na,"onSelectionChange",function(){var a=na.getSelectedFeature();a&&("Wickenburg Parcels"===a.attributes.layerName?$("#infoLink").show():$("#infoLink").hide())}),oa.on("load",ea),$("#highlight").hide(),$("#multiple").click(function(){$(this).data("clicked",!0),ha=!0,W(),qa=oa.on("click",fa)});var pa=$("#single");pa.click(function(){ha=!1,qa=oa.on("click",fa)}),$("#clearHighlights").click(function(){ha=!1,oa.graphics.clear(),$(pa).prop("checked",!0)});var qa=oa.on("click",fa);oa.on("unload",fa);var ra=(new l({map:oa,scalebarUnit:"english"}),new m({map:oa,visible:!0},a.create("div",{id:"HomeButton"},"mapDiv","last")));ra._homeNode.title="Original Extent",ra.startup();var sa=new n({map:oa,visible:!0},a.create("div",{id:"LocateButton"},"mapDiv","last"));sa.startup();var ta=new J({map:oa,visible:!0,basemap:"satellite"},a.create("div",{id:"BasemapToggle"},"mapDiv","last"));ta.startup();var ua=new o({value:"",zoomScale:10,maxLocations:10,autoComplete:!0,arcgisGeocoder:{sourceCountry:"USA",placeholder:"155 N Tegner St, Wickenburg, AZ"},map:oa},"geosearch");ua.startup(),ua.on("select",Z),ua.on("findResults",_),ua.on("clear",ca);var va=Q({url:appConfig.printUrl,content:{f:"json"}});va.then(T,U);var wa=new D;wa.layerIds=[6],wa.layerOption=D.LAYER_OPTION_SHOW;var xa=oa.addLayer(new C(appConfig.mainURL,{id:"wiZoning",imageParameters:wa,outFields:["*"],visible:!0,opacity:.65})),ya=new D;ya.layerIds=[4],ya.layerOption=D.LAYER_OPTION_SHOW;var za=oa.addLayer(new C(appConfig.mainURL,{id:"wiFlood",imageParameters:ya,outFields:["*"],visible:!1,opacity:.65})),Aa=new D;Aa.layerIds=[5],Aa.layerOption=D.LAYER_OPTION_SHOW;var Ba=oa.addLayer(new C(appConfig.mainURL,{id:"wiPendFlood",imageParameters:Aa,outFields:["*"],visible:!1,opacity:1})),Ca=new D;Ca.layerIds=[1],Ca.layerOption=D.LAYER_OPTION_SHOW;var Da=oa.addLayer(new C(appConfig.mainURL,{id:"tParcels",imageParameters:Ca,outFields:["*"],visible:!1,opacity:1})),Ea=oa.addLayer(new K(appConfig.mainURL+"/3",{id:"coBoundary",mode:K.MODE_ONDEMAND,visible:!0,opacity:1})),Fa=oa.addLayer(new K(appConfig.mainURL+"/2",{id:"wiBoundary",mode:K.MODE_ONDEMAND,visible:!0,opacity:1})),Ga=oa.addLayer(new K(appConfig.mainURL+"/8",{id:"wiMPA",mode:K.MODE_ONDEMAND,visible:!1,opacity:1})),Ha="<strong>GEOID:  ${GEOID10}</strong><br><b>Total Persons:</b>  ${LOWMODUNIV:NumberFormat}<br><b>Low Income:</b>  ${LOW:NumberFormat}<br><b>Low & Moderate Income:</b>  ${LOWMOD:NumberFormat}<br><b>Low, Moderate, & Medium Income:</b>  ${LMMI:NumberFormat}<br><b>% Low & Moderate Income:</b> ${LOWMOD_PCT}%",Ia=new M("Wickenburg Block Groups",Ha),Ja=oa.addLayer(new K(appConfig.mainURL+"/7",{id:"wiBlockGroups",visible:!1,opacity:1,mode:K.MODE_ONDEMAND,infoTemplate:Ia,outFields:["*"]})),Ka="<strong>${EmpName}</strong><hr class='pLine'>${Address}</br>${Jurisdiction}, ${State} ${Zip}<br>Type:  ${Cluster}",La=new M("Employers",Ka),Ma=oa.addLayer(new K(appConfig.mainURL+"/0",{id:"wiEmployers",visible:!1,opacity:1,mode:K.MODE_ONDEMAND,infoTemplate:La,outFields:["*"]})),Na=oa.enableSnapping({snapKey:h("mac")?g.META:g.CTRL}),Oa=[{layer:Da}];Na.setLayerInfos(Oa);var Pa=new k({map:oa,lineSymbol:ka},b.byId("measurementDiv"));Pa.startup(),c(Pa.area,"click",V),c(Pa.distance,"click",V),c(Pa.location,"click",V),ia.push({layer:Da,id:"tParcels",title:"Parcels"}),ia.push({layer:Fa,id:"wiBoundary",title:"Town Boundary"}),ia.push({layer:Ga,id:"wiMPA",title:"Municipal Planning Area"}),ia.push({layer:za,id:"wiFlood",title:"Flood Zone"}),ia.push({layer:Ba,id:"wiPendFlood",title:"Pending Flood Zone"}),ia.push({layer:xa,id:"wiZoning",title:"Zoning"}),ia.push({layer:Ma,id:"wiEmployers",title:"Employers, 5+ employees"}),ia.push({layer:Ja,id:"wiBlockGroups",title:"Selected Block Groups"}),ja.push({layer:Da,id:"tParcels",title:"Parcels"}),ja.push({layer:Ea,id:"coBoundary",title:"Maricopa County Boundary"}),ja.push({layer:Fa,id:"wiBoundary",title:"Town Boundary"}),ja.push({layer:za,id:"wiFlood",title:"Flood Zone"}),ja.push({layer:Ba,id:"wiPendFlood",title:"Pending Flood Zone"}),ja.push({layer:Ja,id:"wiBlockGroups",title:"Selected Block Groups"}),ja.push({layer:Ga,id:"wiMPA",title:"Municipal Planning Area"}),ja.push({layer:xa,id:"wiZoning",title:"Zoning"});var Qa=new E({map:oa,layerInfos:ja},"legendDiv");Qa.startup(),y.forEach(ia,function(c){var d=c.title,e=new F({name:"checkBox"+c.layer.id,value:c.layer.id,checked:c.layer.visible,onChange:function(){var a=oa.getLayer(this.value);a.setVisibility(!a.visible),"tParcels"===this.value&&(this.checked?(a.visible,Y(1),$("#highlight").fadeIn()):($("#highlight").fadeOut(),Y(0))),"wiZoning"===this.value&&(this.checked?$("#zoneDefinitionsLink").show():$("#zoneDefinitionsLink").hide()),("wiFlood"===this.value||"wiPendFlood"===this.value)&&(oa.getLayer("wiFlood").visible||oa.getLayer("wiPendFlood").visible?$("#floodZoneDefinitionsLink").show():$("#floodZoneDefinitionsLink").hide())}});a.place(e.domNode,b.byId("toggleDiv"));var f=a.create("label",{"for":e.name,innerHTML:"&nbsp;&nbsp;"+d},e.domNode,"after");a.place("<br>",f,"after")});var Ra=(new G({name:"slider1",value:za.opacity,minimum:0,maximum:1,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){za.setOpacity(a)}},"slider1"),new G({name:"slider2",value:xa.opacity,minimum:0,maximum:1,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){xa.setOpacity(a)}},"slider2"),new G({name:"slider3",value:xa.opacity,minimum:1,maximum:5,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){X(a)}},"slider3"),da("img/blue-pin.png",0,12,35)),Sa=a.create("a",{"class":"action",id:"infoLink",innerHTML:"Assessor Info",href:"javascript: void(0);"},f(".actionList",oa.infoWindow.domNode)[0]);c(Sa,"click",function(){var a=oa.infoWindow.getSelectedFeature(),b=(window.location,"");"013"===a.attributes.COUNTY_FIPS&&(b=appConfig.MaricopaAssessor+a.attributes.PARCEL,window.open(b)),"025"===a.attributes.COUNTY_FIPS&&(b=appConfig.YavapaiAssessor+a.attributes.PARCEL,window.open(b))})}),$(document).ready(function(){$("#contentsOpen").fadeTo("slow"),$("#legend").fadeTo("slow"),$("#legend").draggable({containment:"#mapDiv"}),contentsOpen=$("#contentsOpen").height(),$("#legend").css("top","55px"),$("#contentsOpen").click(function(){toggleContent()})}),$(document).ready(function(){$("#measureOpen").fadeTo("slow"),$("#mTool").fadeTo("slow"),measureOpen=$("#measureOpen").height(),$("#mTool").css("top","55px"),$("#measureOpen").click(function(){toggleMTool()})}),$(document).ready(function(){$("#mTool").hide()}),$(document).ready(function(){$("#printOpen").fadeTo("slow"),$("#printTool").fadeTo("slow"),printOpen=$("#printOpen").height(),$("#printTool").css("top","55px"),$("#printOpen").click(function(){togglePrint()}),$("#reportOpen").fadeTo("slow"),$("#reportTool").fadeTo("slow"),reportOpen=$("#reportOpen").height(),$("#reportOpen").click(function(){toggleReportWindow()})}),$(document).ready(function(){$("#printTool").hide(),$("#reportTool").hide()}),$(document).ready(function(){$("#legend").load("views/contents.html"),$("#helpContent").load("views/helpContent.html"),$("#aboutInfo").load("views/about.html"),$("#legalDisclaimer").load("views/legalDisclaimer.html"),$("#definitions").load("views/definitions.html"),$("#floodDefinitions").load("views/floodDefinitions.html"),$("#mTool").load("views/measureTool.html"),$("#helpTool").load("views/helpTool.html"),$("#printTool").load("views/printTool.html"),$("#helpPrint").load("views/helpPrint.html"),$("#reportTool").load("views/reportWindow.html")});